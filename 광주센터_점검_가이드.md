# ê´‘ì£¼ì„¼í„° ì ê²€ ê°€ì´ë“œ

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

### 1. í•„ìš”í•œ ë„êµ¬ ì„¤ì¹˜

ê´‘ì£¼ì„¼í„° PCì— ë‹¤ìŒ ë„êµ¬ë“¤ì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

#### í•„ìˆ˜ ë„êµ¬
- **Ansible** (2.9 ì´ìƒ)
  ```bash
  # Ubuntu/Debian
  sudo apt update
  sudo apt install ansible
  
  # ë˜ëŠ” Python pipë¡œ ì„¤ì¹˜
  pip3 install ansible
  ```

- **Python 3.8 ì´ìƒ**
  ```bash
  python3 --version
  ```

- **Git** (í”„ë¡œì íŠ¸ ì½”ë“œ ë‹¤ìš´ë¡œë“œìš©)
  ```bash
  sudo apt install git
  ```

#### ì„ íƒ ë„êµ¬
- **WSL** (Windows ì‚¬ìš© ì‹œ)
- **SSH í´ë¼ì´ì–¸íŠ¸** (ì„œë²„ ì ‘ì† í…ŒìŠ¤íŠ¸ìš©)

---

## ğŸš€ ì„¤ì • ë‹¨ê³„

### 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì½”ë“œ ì¤€ë¹„

#### ë°©ë²• 1: Git í´ë¡  (ê¶Œì¥)
```bash
# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd ~

# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/sth0824/ansible_server_check.git
cd ansible_server_check
git checkout develop
```

#### ë°©ë²• 2: USBë¡œ ì½”ë“œ ë³µì‚¬
```bash
# USBì—ì„œ í”„ë¡œì íŠ¸ ë³µì‚¬
cp -r /media/usb/ansible ~/ansible
cd ~/ansible
```

---

### 2ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸

#### 2.1 ì¤‘ì•™ API ì„œë²„ ì ‘ê·¼ í™•ì¸

ì¤‘ì•™ API ì„œë²„ ì£¼ì†Œ: `http://192.168.0.18:8000`

```bash
# API ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
curl http://192.168.0.18:8000/api/health

# ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
# http://192.168.0.18:8000/api/health
```

**âœ… ì„±ê³µ ì‹œ:**
```json
{
  "status": "healthy",
  "timestamp": "2026-01-12T10:30:00"
}
```

**âŒ ì‹¤íŒ¨ ì‹œ (ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ):**
- VPN ì—°ê²° í•„ìš” ì—¬ë¶€ í™•ì¸
- ë°©í™”ë²½ ì„¤ì • í™•ì¸
- ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜

#### 2.2 API ì„œë²„ ì£¼ì†Œ ë³€ê²½ (í•„ìš” ì‹œ)

ë§Œì•½ ì¤‘ì•™ ì„œë²„ IPê°€ ë‹¤ë¥´ê±°ë‚˜ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤ë©´:

**ì˜µì…˜ 1: VPN ì—°ê²°**
- Radmin VPN ë“± VPN ì—°ê²° í›„ ì ‘ê·¼

**ì˜µì…˜ 2: ë¡œì»¬ API ì„œë²„ ì‹¤í–‰ (ì„ì‹œ)**
```bash
cd ~/ansible/api_server
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python3 main.py
```

ê·¸ë¦¬ê³  `config/api_config.yml` ìˆ˜ì •:
```yaml
api_server:
  url: "http://localhost:8000/api/checks"  # ë¡œì»¬ ì„œë²„ ì‚¬ìš©
```

---

### 3ë‹¨ê³„: ê´‘ì£¼ì„¼í„° ì„œë²„ ì •ë³´ ìˆ˜ì§‘

ì ê²€í•  ê´‘ì£¼ì„¼í„° ì„œë²„ì˜ ë‹¤ìŒ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”:

- [ ] **ì„œë²„ IP ì£¼ì†Œ** (ì˜ˆ: `10.0.0.100`)
- [ ] **SSH í¬íŠ¸** (ê¸°ë³¸: 22)
- [ ] **SSH ì‚¬ìš©ìëª…** (ì˜ˆ: `root`, `admin`)
- [ ] **ì¸ì¦ ë°©ë²•**
  - [ ] ë¹„ë°€ë²ˆí˜¸
  - [ ] SSH í‚¤ íŒŒì¼
- [ ] **ì ê²€ ëŒ€ìƒ**
  - [ ] OS ì ê²€
  - [ ] WAS ì ê²€
  - [ ] DB ì ê²€ (MariaDB/PostgreSQL/CUBRID)

---

### 4ë‹¨ê³„: Inventory íŒŒì¼ ì„¤ì •

#### 4.1 ìƒˆ Inventory íŒŒì¼ ìƒì„±

```bash
cd ~/ansible
nano inventory/gwangju_servers.ini
```

#### 4.2 ì„œë²„ ì •ë³´ ì…ë ¥

**ë¹„ë°€ë²ˆí˜¸ ì¸ì¦:**
```ini
[gwangju_servers]
gwangju_server1 ansible_host=10.0.0.100 ansible_user=root ansible_ssh_pass=ë¹„ë°€ë²ˆí˜¸
gwangju_server2 ansible_host=10.0.0.101 ansible_user=root ansible_ssh_pass=ë¹„ë°€ë²ˆí˜¸
```

**SSH í‚¤ ì¸ì¦ (ê¶Œì¥):**
```ini
[gwangju_servers]
gwangju_server1 ansible_host=10.0.0.100 ansible_user=root ansible_ssh_private_key_file=~/.ssh/gwangju_key
gwangju_server2 ansible_host=10.0.0.101 ansible_user=root ansible_ssh_private_key_file=~/.ssh/gwangju_key
```

**ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš© ì‹œ:**
```ini
[gwangju_servers]
gwangju_server1 ansible_host=10.0.0.100 ansible_user=root ansible_port=2222 ansible_ssh_pass=ë¹„ë°€ë²ˆí˜¸
```

---

### 5ë‹¨ê³„: SSH ì ‘ì† í…ŒìŠ¤íŠ¸

```bash
# ì§ì ‘ SSH ì ‘ì† í…ŒìŠ¤íŠ¸
ssh -p 22 root@10.0.0.100

# Ansible ì—°ê²° í…ŒìŠ¤íŠ¸
ansible -i inventory/gwangju_servers.ini gwangju_servers -m ping
```

**âœ… ì„±ê³µ ì‹œ:**
```
gwangju_server1 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
```

---

### 6ë‹¨ê³„: API ì„¤ì • í™•ì¸

`config/api_config.yml` íŒŒì¼ í™•ì¸:

```yaml
api_server:
  url: "http://192.168.0.18:8000/api/checks"  # ì¤‘ì•™ ì„œë²„ ì£¼ì†Œ
  timeout: 60
  retry_count: 5

default_checker: "ì„±íƒœí™˜"  # ë³¸ì¸ ì´ë¦„ìœ¼ë¡œ ë³€ê²½
```

**ì¤‘ì•™ ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ê²½ìš°:**
- ë¡œì»¬ API ì„œë²„ ì‹¤í–‰ (2ë‹¨ê³„ ì°¸ê³ )
- ë˜ëŠ” `api_config.yml`ì—ì„œ ë¡œì»¬ ì£¼ì†Œë¡œ ë³€ê²½

---

## ğŸ”§ ì ê²€ ì‹¤í–‰

### OS ì ê²€
```bash
cd ~/ansible
ansible-playbook -i inventory/gwangju_servers.ini redhat_check/redhat_check.yml
```

### WAS ì ê²€
```bash
ansible-playbook -i inventory/gwangju_servers.ini tomcat_check/tomcat_check.yml
```

### MariaDB ì ê²€
```bash
ansible-playbook -i inventory/gwangju_servers.ini mariadb_check/mariadb_check.yml
```

### PostgreSQL ì ê²€
```bash
ansible-playbook -i inventory/gwangju_servers.ini postgresql_check/postgresql_check.yml
```

### CUBRID ì ê²€
```bash
ansible-playbook -i inventory/gwangju_servers.ini cubrid_check/cubrid_check.yml
```

---

## ğŸ“Š ì ê²€ ê²°ê³¼ í™•ì¸

### ë°©ë²• 1: ì›¹ ëŒ€ì‹œë³´ë“œ (ì¤‘ì•™ ì„œë²„ ì ‘ê·¼ ê°€ëŠ¥ ì‹œ)
```
http://192.168.0.18:8000/api/db-checks/report
http://192.168.0.18:8000/api/os-checks/report
http://192.168.0.18:8000/api/was-checks/report
```

### ë°©ë²• 2: ë¡œì»¬ ë°±ì—… íŒŒì¼ í™•ì¸
ì ê²€ ê²°ê³¼ëŠ” ë¡œì»¬ì—ë„ JSON íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤:
```bash
ls -la /tmp/*_check_result_*.json
cat /tmp/os_check_result_*.json
```

### ë°©ë²• 3: API ì‘ë‹µ í™•ì¸
ì ê²€ ì‹¤í–‰ ì‹œ ë§ˆì§€ë§‰ì— API ì „ì†¡ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤:
```
API ì „ì†¡ ê²°ê³¼:
- ìƒíƒœ ì½”ë“œ: 200
- ì‘ë‹µ: {"success": true, "id": 123}
```

---

## âš ï¸ ë¬¸ì œ í•´ê²°

### 1. API ì„œë²„ ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ:**
```
âš ï¸ API ì„œë²„ë¡œ ì „ì†¡ ì‹¤íŒ¨. ë¡œì»¬ íŒŒì¼ì€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: /tmp/os_check_result_*.json
```

**í•´ê²° ë°©ë²•:**
1. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
   ```bash
   ping 192.168.0.18
   curl http://192.168.0.18:8000/api/health
   ```

2. VPN ì—°ê²° í™•ì¸
   - Radmin VPN ë“± VPN ì—°ê²° í•„ìš” ì—¬ë¶€ í™•ì¸

3. ë°©í™”ë²½ í™•ì¸
   - í¬íŠ¸ 8000ì´ ì°¨ë‹¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

4. ë¡œì»¬ ë°±ì—… íŒŒì¼ í™•ì¸
   - `/tmp/*_check_result_*.json` íŒŒì¼ í™•ì¸
   - ë‚˜ì¤‘ì— ìˆ˜ë™ìœ¼ë¡œ API ì„œë²„ì— ì „ì†¡ ê°€ëŠ¥

### 2. SSH ì ‘ì† ì‹¤íŒ¨

**ì¦ìƒ:**
```
gwangju_server1 | UNREACHABLE!
```

**í•´ê²° ë°©ë²•:**
1. ì„œë²„ IP ì£¼ì†Œ í™•ì¸
   ```bash
   ping 10.0.0.100
   ```

2. SSH í¬íŠ¸ í™•ì¸
   ```bash
   telnet 10.0.0.100 22
   # ë˜ëŠ”
   nc -zv 10.0.0.100 22
   ```

3. SSH í‚¤ ê¶Œí•œ í™•ì¸
   ```bash
   chmod 600 ~/.ssh/gwangju_key
   ```

4. ì§ì ‘ SSH ì ‘ì† í…ŒìŠ¤íŠ¸
   ```bash
   ssh -v -p 22 root@10.0.0.100
   ```

### 3. Ansible ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ

**í•´ê²° ë°©ë²•:**
```bash
# Ansible ì„¤ì¹˜ í™•ì¸
which ansible-playbook

# ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´
sudo apt install ansible
# ë˜ëŠ”
pip3 install ansible
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

ê´‘ì£¼ì„¼í„° ì ê²€ ì „ í™•ì¸ì‚¬í•­:

- [ ] Ansible ì„¤ì¹˜ í™•ì¸
- [ ] Python 3.8 ì´ìƒ ì„¤ì¹˜ í™•ì¸
- [ ] í”„ë¡œì íŠ¸ ì½”ë“œ ì¤€ë¹„ (Git í´ë¡  ë˜ëŠ” USB ë³µì‚¬)
- [ ] ì¤‘ì•™ API ì„œë²„ ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
- [ ] ê´‘ì£¼ì„¼í„° ì„œë²„ ì ‘ì† ì •ë³´ ìˆ˜ì§‘
- [ ] Inventory íŒŒì¼ ìƒì„± ë° ì„¤ì •
- [ ] SSH ì ‘ì† í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] API ì„¤ì • íŒŒì¼ í™•ì¸ (`config/api_config.yml`)
- [ ] ë‹´ë‹¹ì ì´ë¦„ ì„¤ì • (`default_checker`)

---

## ğŸ’¡ íŒ

### 1. ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œ ì ê²€
ì¤‘ì•™ API ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ê²½ìš°:
- ì ê²€ì€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë¨
- ê²°ê³¼ëŠ” `/tmp/*_check_result_*.json`ì— ì €ì¥
- ë‚˜ì¤‘ì— ì¸í„°ë„· ì—°ê²° í›„ ìˆ˜ë™ìœ¼ë¡œ ì „ì†¡ ê°€ëŠ¥

### 2. ì—¬ëŸ¬ ì„œë²„ í•œ ë²ˆì— ì ê²€
```bash
# ëª¨ë“  ì„œë²„ ì ê²€
ansible-playbook -i inventory/gwangju_servers.ini redhat_check/redhat_check.yml

# íŠ¹ì • ì„œë²„ë§Œ ì ê²€
ansible-playbook -i inventory/gwangju_servers.ini redhat_check/redhat_check.yml --limit gwangju_server1
```

### 3. ìƒì„¸ ë¡œê·¸ í™•ì¸
```bash
# ìƒì„¸ ë¡œê·¸ë¡œ ì‹¤í–‰
ansible-playbook -i inventory/gwangju_servers.ini redhat_check/redhat_check.yml -v

# ë” ìƒì„¸í•œ ë¡œê·¸
ansible-playbook -i inventory/gwangju_servers.ini redhat_check/redhat_check.yml -vvv
```

### 4. ì ê²€ ê²°ê³¼ ë°±ì—…
```bash
# JSON íŒŒì¼ ë°±ì—…
mkdir -p ~/gwangju_check_backup
cp /tmp/*_check_result_*.json ~/gwangju_check_backup/
```

---

## ğŸ” ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

1. **ë¹„ë°€ë²ˆí˜¸ë¥¼ íŒŒì¼ì— ì§ì ‘ ì‘ì„±í•˜ì§€ ë§ˆì„¸ìš”**
   - ê°€ëŠ¥í•˜ë©´ SSH í‚¤ ì‚¬ìš©
   - Ansible Vault ì‚¬ìš© ê¶Œì¥

2. **Inventory íŒŒì¼ ë³´ì•ˆ**
   ```bash
   chmod 600 inventory/gwangju_servers.ini
   ```

3. **Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”**
   - `.gitignore`ì— `inventory/gwangju_servers.ini` ì¶”ê°€ í™•ì¸

---

**ì‘ì„±ì¼**: 2026ë…„ 1ì›” 12ì¼  
**ì‘ì„±ì**: ì„±íƒœí™˜
